name: gwscan build and run
on:
  push:
    branches:
      - "godwoken-v1-mainnet-prod"

jobs:
  prod-mainnet-build-run:
    runs-on: [self-hosted, godwoken_mainnet_v1_prod]
    environment: prod_mainnet_v1
    env:
      ENV_FILE_PATH: ${{secrets.ENV_FILE_PATH}}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Docker Compose build
        run: docker-compose -f ./docker_compose/gwscan_compose.yml --env-file ${{secrets.ENV_FILE_PATH}} build gwscan

      - name: Docker Compose run
        run: docker-compose -f ./docker_compose/gwscan_compose.yml --env-file ${{secrets.ENV_FILE_PATH}} up -d --force-recreate gwscan

      - name: Clean up unused images
        run: docker image prune -f

        ./config.sh --url https://github.com/Magickbase/godwoken_explorer --token ADA6YLTBX4M33NMCEZVHM23CXFN7O
